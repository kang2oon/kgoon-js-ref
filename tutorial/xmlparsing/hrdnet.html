<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,user-scalable=no"/>
	<title>XML Parsing</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" />
	<link rel="stylesheet" type="text/css" href="/tutorial/css/common.css" />
    <link rel="stylesheet" type="text/css" href="/tutorial/css/xmlparsing.css" />
</head>
<body>
<div class="container">
    <div class="search_wrap">
        <div>
            <label>AuthKey</label>
            <input type="text" id="key" placeholder="API KEY 값을 입력하세요." value="841bd167-8fb0-4f38-b839-29b40708e3f2">
        </div>
        <div>
            <label>Page</label>
            <input type="text" id="page" placeholder="출력 페이지 번호를 입력하세요." value="1">
        </div>
        <div>
            <label>페이지당 출력 수량</label>
            <input type="text" id="size" placeholder="페이지당 표시할 수량을 입력하세요.(최대 100개)" value="100">
        </div>
        <div>
            <label>교육 시작일</label>
            <input type="date" id="sdate" value="2024-01-01">
        </div>
        <div>
            <label>교육 종료일</label>
            <input type="date" id="edate" value="2024-12-31">
        </div>
        <div>
            <label>정렬 방법</label>
            <select  id="sort2">
                <option value="TOT_FXNUM">모집인원(TOT_FXNUM)</option>
                <option value="TRNG_BGDE" selected>훈련시작일(TRNG_BGDE)</option>
                <option value="TRNG_CRSN">훈련과정명(TRNG_CRSN)</option>
            </select>
        </div>
        <div>
            <label>정렬 순서</label>
            <select id="sort1">
                <option value="ASC" selected>오름차순(ASC)</option>
                <option value="DESC">내림차순(DESC)</option>
            </select>
        </div>
        <div>
            <label>지역</label>
            <select id="area">
                <option value="11">서울(11)</option>
                <option value="26">부산(26)</option>
                <option value="27">대구(27)</option>
                <option value="28">인천(28)</option>
                <option value="29">광주(29)</option>
                <option value="30">대전(30)</option>
                <option value="31">울산(31)</option>
                <option value="36">세종(36)</option>
                <option value="41" selected>경기(41)</option>
                <option value="43">충북(43)</option>
                <option value="44">충남(44)</option>
                <option value="45">전북(45)</option>
                <option value="46">전남(46)</option>
                <option value="47">경북(47)</option>
                <option value="48">경남(48)</option>
                <option value="50">제주(50)</option>
                <option value="51">강원(51)</option>
            </select>
        </div>
        <div>
            <label>경기 상세지역</label>
            <select id="area2">
                <option value="">경기 상세지역</option>
                <option value="41110">수원시(41110)</option>
                <option value="41111">수원시 장안구(41111)</option>
                <option value="41113">수원시 권선구(41113)</option>
                <option value="41115">수원시 팔달구(41115)</option>
                <option value="41117">수원시 영통구(41117)</option>
                <option value="41130">성남시(41130)</option>
                <option value="41131">성남시 수정구(41131)</option>
                <option value="41133">성남시 중원구(41133)</option>
                <option value="41135">성남시 분당구(41135)</option>
                <option value="41150">의정부시(41150)</option>
                <option value="41170">안양시(41170)</option>
                <option value="41171">안양시 만안구(41171)</option>
                <option value="41173">안양시 동안구(41173)</option>
                <option value="41190">부천시(41190)</option>
                <option value="41192">부천시 원미구(41192)</option>
                <option value="41194">부천시 소사구(41194)</option>
                <option value="41196">부천시 오정구(41196)</option>
                <option value="41210">광명시(41210)</option>
                <option value="41220">평택시(41220)</option>
                <option value="41250">동두천시(41250)</option>
                <option value="41270">안산시(41270)</option>
                <option value="41271">안산시 상록구(41271)</option>
                <option value="41273">안산시 단원구(41273)</option>
                <option value="41280">고양시(41280)</option>
                <option value="41281">고양시 덕양구(41281)</option>
                <option value="41285">고양시 일산동구(41285)</option>
                <option value="41287">고양시 일산서구(41287)</option>
                <option value="41290">과천시(41290)</option>
                <option value="41310">구리시(41310)</option>
                <option value="41360">남양주시(41360)</option>
                <option value="41370">오산시(41370)</option>
                <option value="41390">시흥시(41390)</option>
                <option value="41410">군포시(41410)</option>
                <option value="41430">의왕시(41430)</option>
                <option value="41450">하남시(41450)</option>
                <option value="41460">용인시(41460)</option>
                <option value="41461">용인시 처인구(41461)</option>
                <option value="41463">용인시 기흥구(41463)</option>
                <option value="41465">용인시 수지구(41465)</option>
                <option value="41480">파주시(41480)</option>
                <option value="41500">이천시(41500)</option>
                <option value="41550">안성시(41550)</option>
                <option value="41570">김포시(41570)</option>
                <option value="41590">화성시(41590)</option>
                <option value="41610">광주시(41610)</option>
                <option value="41630">양주시(41630)</option>
                <option value="41650">포천시(41650)</option>
                <option value="41670">여주시(41670)</option>
                <option value="41800">연천군(41800)</option>
                <option value="41820">가평군(41820)</option>
                <option value="41830">양평군(41830)</option>
            </select>
        </div>
        <div>
            <label>훈련유형</label>
            <select id="case">
                <option value="">훈련유형 선택</option>
                <option value="C0061">국민내일배움카드(일반)(C0061)</option>
                <option value="C0061S">국민내일배움카드(주 훈련대상 : 구직자)(C0061S)</option>
                <option value="C0061I">국민내일배움카드(주 훈련대상 : 재직자)(C0061I)</option>
                <option value="C0054">국가기간전략산업직종(C0054)</option>
                <option value="C0055C">과정평가형훈련(C0055C)</option>
                <option value="C0054G">기업맞춤형훈련(C0054G)</option>
                <option value="C0054Y">스마트혼합훈련(C0054Y)</option>
                <option value="C0054S">일반고특화훈련(C0054S)</option>
                <option value="C0054I">4차산업혁명인력양성훈련(C0054I)</option>
                <option value="C0104">K-디지털 트레이닝(C0104)</option>
                <option value="C0105">K-디지털 기초역량훈련(C0105)</option>
                <option value="C0103">플랫폼종사자훈련(C0103)</option>
                <option value="C0102">산업구조변화대응(C0102)</option>
                <option value="C0106">중장년새출발카운슬링(C0106)</option>
                <option value="C0055">실업자 원격훈련(C0055)</option>
                <option value="C0031">근로자 원격훈련(C0031)</option>
                <option value="C0031F">근로자 외국어훈련(C0031F)</option>
            </select>
        </div>
        <div>
            <label></label>
            <button class="search">검색</button>
        </div>
    </div>
    <div class="page_info">
        <div>총 <span class="total">0</span>개 과정</div>
        <div class="totalpage"><span class="current">0</span><span class="last">0</span></div>
    </div>
	<table id="region" class="full">
        <thead>
        <tr>
            <th>No</th>
            <th>교육코드</th>
            <th>지역</th>
            <th>과정명</th>
            <th>훈련대상</th>
            <th>교육기관</th>
            <th>교육기관 연락처</th>
            <th>교육회차</th>
            <th>교육시작일</th>
            <th>교육종료일</th>
            <th>훈련비</th>
            <th>정원</th>
            <th>콘텐츠</th>
        </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
</div>

	
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js" ></script>
<script>
	// $(document).ready(function(){
	// 	$.ajax({
    //         url: 'https://www.work24.go.kr/cm/openApi/call/hr/callOpenApiSvcInfo310L01.do?authKey=841bd167-8fb0-4f38-b839-29b40708e3f2&returnType=XML&outType=1&pageNum=1&pageSize=100&srchTraStDt=20240101&srchTraEndDt=20241231&sort=ASC&sortCol=TRNG_BGDE&srchTraArea1=41',
    //         type: 'GET',
    //         dataType: 'xml',
    //         error: function(){
    //             alert('Error loading XML document');
    //         },
    //         success: function(xml){
    //             var cnt = $(xml).find("scn_cnt").text();
    //             var total = cnt.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    //             $('.total').text(total);
    //             $(xml).find("scn_list").each(function(num){
    //                 var id = $(this).find("trprId").text();
    //                 var local = $(this).find("address").text();
    //                 var subject = $(this).find("title").text();
    //                 var link = $(this).find("titleLink").text();
    //                 var target = $(this).find("trainTarget").text();
    //                 var company = $(this).find("subTitle").text();
    //                 var clink = $(this).find("subTitleLink").text();
    //                 var tel = $(this).find("telNo").text();
    //                 var sdate = $(this).find("traStartDate").text();
    //                 var edate = $(this).find("traEndDate").text();
    //                 var pay = $(this).find("realMan").text().toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    //                 var yard = $(this).find("yardMan").text().toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    //                 var contents = $(this).find("contents").text();

    //                 var sprint  = "<tr><td>" +num+ "</td>";
    //                     sprint += "<td>" +id+ "</td>";
    //                     sprint += "<td>" +local+ "</td>";
    //                     sprint += "<td><a href='"+link+"' target='_blank'>"+subject+ "</a></td>";
    //                     sprint += "<td>" +target+ "</td>";
    //                     sprint += "<td><a href='"+clink+"' target='_blank'>"+company+ "</a></td>";
    //                     sprint += "<td>" +tel+ "</td>";
    //                     sprint += "<td>" +sdate+ "</td>";
    //                     sprint += "<td>" +edate+ "</td>";
    //                     sprint += "<td>" +pay+ "</td>";
    //                     sprint += "<td>" +yard+ "</td>";
    //                     sprint += "<td>" +contents+ "</td>";
    //                     sprint += "</tr>";
    //                 $('#region > tbody').append(sprint);
    //             });
    //         }
    //     });
	// });
    $(document).ready(function(){
        var krarea = $("#area option:selected").val();
        var ggarea = $("#area2");
        if(krarea != 41){
            ggarea.attr("disabled",true);
        }        
        $("#area").on("change", function(){
            var krarea = $("#area option:selected").val();
            var ggarea = $("#area2");
            if(krarea != 41){
                ggarea.attr("disabled",true);
                $("#area2 option:eq(0)").prop("selected", true);
            }else{
                ggarea.attr("disabled",false);
            }
        });
    });

    $('.search_wrap button').click(function(){
        var regExp = /[\{\}\[\]\/?.,;:|\)*~`!^\-_+<>@\#$%&\\\=\(\'\"]/gi;
        var key = $("#key").val();
        var size = $("#size").val();
        var page = $("#page").val();
        var sdate = $("#sdate").val().replace(/(^\s*)|(\s*$)/gi, '').replace(regExp, '');
        var edate = $("#edate").val().replace(/(^\s*)|(\s*$)/gi, '').replace(regExp, '');
        var sort1 = $("#sort1 option:selected").val();
        var sort2 = $("#sort2 option:selected").val();
        var area = $("#area option:selected").val();
        var area2 = $("#area2 option:selected").val();
        var tcase = $("#case option:selected").val();
        var url = "https://www.work24.go.kr/cm/openApi/call/hr/callOpenApiSvcInfo310L01.do?authKey="+key+"&returnType=XML&outType=1&pageNum="+page+"&pageSize="+size+"&srchTraStDt="+sdate+"&srchTraEndDt="+edate+"&sort="+sort1+"&sortCol="+sort2+"&srchTraArea1="+area+"&srchTraArea2="+area2+"&crseTracseSe="+tcase;
        console.log(url);
        $('#region > tbody').empty();
        $.ajax({
            url: url,
            type: 'GET',
            dataType: 'xml',
            error: function(){
                alert('Error loading XML document');
            },
            success: function(xml){
                var cnt = $(xml).find("scn_cnt").text();
                var total = cnt.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                $('.total').text(total);
                var lastpage = Math.ceil(cnt/size).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                $('.current').text(page);
                $('.last').text(lastpage);
                $(xml).find("scn_list").each(function(num){
                    var num = num+1;
                    var id = $(this).find("trprId").text();
                    var local = $(this).find("address").text();
                    var subject = $(this).find("title").text();
                    var link = $(this).find("titleLink").text();
                    var target = $(this).find("trainTarget").text();
                    var company = $(this).find("subTitle").text();
                    var clink = $(this).find("subTitleLink").text();
                    var tel = $(this).find("telNo").text();
                    var sdate = $(this).find("traStartDate").text();
                    var edate = $(this).find("traEndDate").text();
                    var pay = $(this).find("realMan").text().toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                    var yard = $(this).find("yardMan").text().toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                    var contents = $(this).find("contents").text();
                    var degr = $(this).find("trprDegr").text();

                    var sprint  = "<tr><td>" +num+ "</td>";
                        sprint += "<td>" +id+ "</td>";
                        sprint += "<td>" +local+ "</td>";
                        sprint += "<td><a href='"+link+"' target='_blank'>"+subject+ "</a></td>";
                        sprint += "<td>" +target+ "</td>";
                        sprint += "<td><a href='"+clink+"' target='_blank'>"+company+ "</a></td>";
                        sprint += "<td>" +tel+ "</td>";
                        sprint += "<td>" +degr+ "</td>";
                        sprint += "<td>" +sdate+ "</td>";
                        sprint += "<td>" +edate+ "</td>";
                        sprint += "<td>" +pay+ "</td>";
                        sprint += "<td>" +yard+ "</td>";
                        sprint += "<td>" +contents+ "</td>";
                        sprint += "</tr>";
                    $('#region > tbody').append(sprint);
                });
            }
        });
    });
</script>
</body>
</html>